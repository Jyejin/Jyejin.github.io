<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Tag: project - 개발계발 블로그</title><meta property="og:type" content="blog"><meta property="og:title" content="개발계발 블로그"><meta property="og:url" content="https://jyejin.github.io/"><meta property="og:site_name" content="개발계발 블로그"><meta property="og:locale" content="en_US"><meta property="article:author" content="Yejin Jeong"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://jyejin.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://jyejin.github.io"},"headline":"개발계발 블로그","image":["https://jyejin.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Yejin Jeong"},"description":""}</script><link rel="icon" href="/img/berry.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">개발계발</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">project</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-08-09T08:30:05.000Z" title="2020-08-09T08:30:05.000Z">2020-08-09</time><span class="level-item"><a class="link-muted" href="/categories/Study/">Study</a></span><span class="level-item">9 minutes read (About 1283 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/08/09/project-3/">pytest 사용기 - fixture, scope</a></h1><div class="content"><br/>
파이썬에서 제공하는 테스팅 모듈로는 unittest, pytest가 유명한데, 둘 중 어느걸 사용해 볼까 하다가 pytest가 간단해 보여서 pytest로 작업을 진행했습니다. 빠른 진행을 위해서는 테스팅 모듈이 간편한게 좋을 것 같다는 생각이 들었기 때문입니다. pytest 어떻게 사용했는지 살펴보겠습니다.

<h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><p>pytest는 <code>pip</code> 로 설치하며 기초 설명은 <a href="https://docs.pytest.org/en/latest/index.html">공식 홈페이지</a>에서 확인 가능합니다.</p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pytest</span><br></pre></td></tr></table></figure>

<h3 id="프로젝트-구조"><a href="#프로젝트-구조" class="headerlink" title="프로젝트 구조"></a>프로젝트 구조</h3><hr>
<p>테스트 코드를 작성한 <a href="https://github.com/Jyejin/logparser">프로젝트</a>의 구조는 다음과 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── logparser</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   └── parser.py</span><br><span class="line">├── logs</span><br><span class="line">│   ├── elb1.log.gz</span><br><span class="line">│   ├── elb2.log.gz</span><br><span class="line">├── pytest.ini</span><br><span class="line">└── test</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── conftest.py</span><br><span class="line">    ├── logs&#x2F;</span><br><span class="line">    └── test_parser.py</span><br></pre></td></tr></table></figure>

<p>pytest를 위해 작성한 파일은 <code>pytest.ini</code>와 test폴더 하위의 파일들입니다. 먼저, <code>pytest.ini</code>에는 테스트에 사용할 파일과 테스트 옵션을 추가합니다. 일반적으로 test_*.py 또는 *_test.py를 테스트 파일로 인식하지만 직접 지정해줄 수도 있습니다. 파일이 여러 개인 경우 스페이스로 구분합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[pytest]</span><br><span class="line">python_files &#x3D; test_parser.py test_*.py</span><br></pre></td></tr></table></figure>

<p>테스트는 <code>pytest</code> 명령어를 사용해 실행합니다. 실행하는 경로에 상관없이 pytest용 파일을 찾아 실행합니다. <code>q</code>옵션을 사용하면 로그를 간략하게 볼 수 있습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(venv) yejinui-MacBook-Pro:logparser yejin$ pytest -q</span><br><span class="line">.....                                                                                                                                                                     [100%]</span><br><span class="line">5 passed in 31.78s</span><br></pre></td></tr></table></figure>

<h3 id="테스트-코드-작성"><a href="#테스트-코드-작성" class="headerlink" title="테스트 코드 작성"></a>테스트 코드 작성</h3><p>테스트 함수에는 아래와 같이 함수명에 접두사로 <code>test_</code> 를 붙여야 합니다. 접두사가 없으면 그 함수는 실행하지 않고 넘어갑니다. count 함수와 sequence 함수를 테스트 하기 위해 각각 <code>test_count</code>, <code>test_sequnce</code>함수를 만들었습니다. <code>test_count</code>는 로그 수가 맞는지를 확인하고 <code>test_sequence</code>는 ‘type’ 별 집계가 일치하는지 확인합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test_parser.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_count</span><span class="params">()</span>:</span></span><br><span class="line">    logs = log_parser(get_test_log)</span><br><span class="line">    <span class="keyword">assert</span> count(logs) == <span class="number">87060</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_sequence</span><span class="params">()</span>:</span></span><br><span class="line">    logs = log_parser(get_test_log)</span><br><span class="line">    <span class="keyword">assert</span> sequence(logs, <span class="string">'type'</span>, reverse=<span class="literal">True</span>) == [</span><br><span class="line">        (<span class="string">'http'</span>, <span class="number">82719</span>),</span><br><span class="line">        (<span class="string">'h2'</span>, <span class="number">3398</span>),</span><br><span class="line">        (<span class="string">'https'</span>, <span class="number">943</span>)</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>두 함수에서는 공통적으로 log_parser()함수를 사용해 로그를 읽어옵니다. 예시 이외에도 로그를 읽어 오는 테스트가 더 있어 클래스를 정의하는 방식으로 변경하였습니다. self.logs를 사용하는 방식으로 코드를 수정했습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestParserClass</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, get_test_log)</span>:</span></span><br><span class="line">        self.logs = list(log_parser(get_test_log))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_count</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> count(self.logs) == <span class="number">87060</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_sequence</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> sequence(self.logs, <span class="string">'type'</span>, reverse=<span class="literal">True</span>) == [</span><br><span class="line">            (<span class="string">'http'</span>, <span class="number">82719</span>),</span><br><span class="line">            (<span class="string">'h2'</span>, <span class="number">3398</span>),</span><br><span class="line">            (<span class="string">'https'</span>, <span class="number">943</span>)</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<p>그런데 에러가 발생했습니다. 클래스에 <code>__init__</code>를 정의한 것이 문제가 되었습니다. <a href="https://docs.pytest.org/en/stable/warnings.html#internal-pytest-warnings">공식 홈페이지</a>를 확인해보니 <code>__init__</code>를 정의하는 경우 클래스가 인스턴스화 되지 않는다고 하네요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(venv) yejinui-MacBook-Pro:logparser yejin$ pytest -q</span><br><span class="line">=============================================================================== warnings summary ================================================================================</span><br><span class="line">test/test_parser.py:<span class="number">9</span></span><br><span class="line">  /Users/yejin/Sites/project/logparser/test/test_parser.py:<span class="number">9</span>: PytestCollectionWarning: cannot collect test <span class="class"><span class="keyword">class</span> '<span class="title">TestParserClass</span>' <span class="title">because</span> <span class="title">it</span> <span class="title">has</span> <span class="title">a</span> <span class="title">__init__</span> <span class="title">constructor</span> <span class="params">(from: test/test_parser.py)</span></span></span><br><span class="line"><span class="class">    <span class="title">class</span> <span class="title">TestParserClass</span>:</span></span><br><span class="line"></span><br><span class="line">-- Docs: https://docs.pytest.org/en/stable/warnings.html</span><br><span class="line"><span class="number">1</span> passed, <span class="number">1</span> warning <span class="keyword">in</span> <span class="number">0.03</span>s</span><br></pre></td></tr></table></figure>

<p>그래서 <code>fixture</code>를 사용했습니다. fixture란, 테스트 시 사용하는 함수들을 미리 정의하는 기능입니다.</p>
<p><code>fixture</code>함수는 test/conftest.py에 작성합니다. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test/conftest.py</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(scope="module")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_log_parse</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> list(log_parser(get_log(<span class="string">'./logs/'</span>)))</span><br></pre></td></tr></table></figure>

<p>test_ 함수에서 사용할 때에는 따로 conftest를 임포트할 필요없이 매개변수로 지정하기만 하면됩니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test_parser.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_count</span><span class="params">(test_log_parse)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> count(test_log_parse) == <span class="number">87060</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_sequence</span><span class="params">(test_log_parse)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> sequence(test_log_parse, <span class="string">'type'</span>, reverse=<span class="literal">True</span>) == [</span><br><span class="line">        (<span class="string">'http'</span>, <span class="number">82719</span>),</span><br><span class="line">        (<span class="string">'h2'</span>, <span class="number">3398</span>),</span><br><span class="line">        (<span class="string">'https'</span>, <span class="number">943</span>)</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>굳이 fixture를 사용하지 않고 test_log_parse 함수를 만들어도 되는게 아닌가 생각할 수도 있습니다. 그렇게도 가능합니다. 그러나 깨끗한 테스트 코드를 위해 변하지 않는 기능은 한 곳에 넣어두고 자주 변경되며 확장할 기능을 만들도록 하는 것이 관리에 좋아 보입니다. 클래스 상속 개념처럼요🙂 그리고 무엇보다도 fixture를 사용하면 fixture가 제공하는 부가 옵션들을 사용할 수 있습니다. 여기서는  <code>scope</code>를 사용했습니다.</p>
<p>scope를 사용해 fixture를 모듈, 클래스, 세션 단위로 공유합니다. 다시 말해, test_ 함수를 실행할 때마다 fixture함수를 재호출하지 않고 사용할 수 있다는 것입니다. scope를 module 단위로 지정했더니, test_log_parse 한 번 호출 후 계속 재사용하기 때문에 아래와 같이 실행 시간이 단축됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;scope 사용</span><br><span class="line">(venv) yejinui-MacBook-Pro:logparser yejin$ pytest -q</span><br><span class="line">.....                                                                                                                                                                     [100%]</span><br><span class="line">5 passed in 34.24s</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;scope 미사용</span><br><span class="line">(venv) yejinui-MacBook-Pro:logparser yejin$ pytest -q</span><br><span class="line">.....                                                                                                                                                                     [100%]</span><br><span class="line">5 passed in 131.13s (0:02:11)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-06T05:43:06.000Z" title="2020-06-06T05:43:06.000Z">2020-06-06</time><span class="level-item"><a class="link-muted" href="/categories/Study/">Study</a><span> / </span><a class="link-muted" href="/categories/Study/Network/">Network</a></span><span class="level-item">6 minutes read (About 955 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/06/06/study1-2/">CORS(Cross Origin Resource Sharing)</a></h1><div class="content"><br/>

<p>CORS란, 오리진(출처, 도메인) 사이에 리소스(자원)를 공유하는 방법을 말한다. 여기서 리소스 공유는 <code>XMLHttpRequest</code>나 <code>Fetch API</code>를 통하여 다른 출처의 자원에 접근하는 것이다. 보안을 위해 모든 서버에서 누구나 접근하는 것을 막고 클라이언트에서 서버로 액세스하기 직전까지의 권한을 확인한다.</p>
<p>보안 상의 이유로, 브라우저는 스크립트에서 시작한 서로 다른 출처의 HTTP 요청을 제한한다. XMLHttpRequest와 Fetch API를 사용하는 웹 애플리케이션은 자신의 출처와 동일한 리소스만 불러올 수 있으며, 예외적으로 다른 출처의 리소스를 불러오려면 자신의 출처를 증명할 수 있는 올바른 CORS 헤더를 포함해야 한다.</p>
<p>CORS에는 프리플라이트 요청을 하지않는 <code>simple cross-origin request</code>와 프리플라이트 요청이 필요한 <code>actual request</code>로 나뉜다. 프리플라이트(prefligt) 요청은 실제 통신 전에 권한을 확인하려 보내는 요청이다.</p>
<h3 id="Simple-Cross-Origin-Request"><a href="#Simple-Cross-Origin-Request" class="headerlink" title="Simple Cross-Origin Request"></a>Simple Cross-Origin Request</h3><p><code>simple cross-origin request</code>가 되는 조건은 다음 3가지이다.</p>
<ul>
<li>http 요청 메서드가 단순 메서드(GET, POST, HEAD)</li>
<li>헤더가 모드 심플 헤더(accept, accept-language, content-language, content-type 이외는 제외)</li>
<li>Content-type을 포함하는 경우, 그 값이 applicatin/x-www-form-urlencoded, multipart/form-data, text-plain 중 하나</li>
</ul>
<h3 id="프리플라이트-요청"><a href="#프리플라이트-요청" class="headerlink" title="프리플라이트 요청"></a>프리플라이트 요청</h3><p><code>simple cross-origin request</code> 조건에 맞지 않는 경우 프리플라이트 요청이 필수이다. 프리플라이트를 할 때 클라이언트는 아래 헤더를 붙여 <code>OPTIONS</code>메서드로 전송한다.</p>
<ul>
<li>Access-control-request-method 요청헤더 : 통신을 허용하길 원하는 메서드 지정</li>
<li>Access-control-reqeust-headers 요청 헤더: 허용하길 원하는 헤더를 쉼표로 구분해 나열</li>
<li>Origin 요청 헤더 : 통신 출처 웹 페이지의 도메인 이름을 지정</li>
</ul>
<p>프리플라이트 요청을 받고 나면, 서버측은 허용하는 통신 내용을 아래 헤더를 사용해 브라우저 측에 전달한다. 허용하지 않는 경우 각각의 헤더가 부여되지 않거나 <code>stauts = 401 forbidden</code>으로 반환되기도 한다.</p>
<ul>
<li>Access-control-allow-origin 응답헤더 : 통신을 허용할 오리진 이름. 쿠키를 이용하지 않을 때는 와일드카드(*)로 모든 도메인을 일괄적으로 허용하기도 한다.</li>
<li>Access-control-allow-method 응답헤더 : 대상 url에 허용되는 메서드 이름.</li>
<li>Access-control-allow-header 응답헤더 : 대상 url에 허용되는 헤더 이름 목록. 플라이트요청이 필요없는 간단한 헤더는 생략될 수 있다.</li>
<li>Access-control-allow-credentials 응답헤더: 쿠키 등의 자격 증명을 서버가 받는 것을 허용할 때 부여된다. 값으로는 true만 설정할 수 있다.</li>
<li>Access-control-expose-header 응답헤더 : 허용이 아니라 서버에서 반환하는 응답 헤더 중 스크립트에서 참조할 수 있는 헤더 이름목록을 반환한다.</li>
</ul>
<p>통신 내용을 일정 기간 캐시해서 통신을 생략하는 방법도 사양에 포함되어 있다. 이 지시에는 다음 헤더를 사용한다.</p>
<ul>
<li>Access-control-max-age 응답 헤더 : cahce-control을 사용한 캐시와 마찬가지로 캐시 가능한 초 수를 서버에서 클라이언트로 전달한다.</li>
</ul>
<p>프리플라이트 요청이 허용되면 실제 요청을 전송한다.</p>
<p>참고<br><a href="https://developer.mozilla.org/ko/docs/Web/HTTP/CORS">https://developer.mozilla.org/ko/docs/Web/HTTP/CORS</a></p>
<p><strong>&lt;리얼월드 HTTP&gt; 도서의 내용을 요약 정리하고 관련 내용을 추가하였습니다.</strong></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-02T05:29:56.000Z" title="2020-06-02T05:29:56.000Z">2020-06-02</time><span class="level-item"><a class="link-muted" href="/categories/Book/">Book</a><span> / </span><a class="link-muted" href="/categories/Book/%EB%A6%AC%EC%96%BC%EC%9B%94%EB%93%9C-HTTP/">리얼월드 HTTP</a></span><span class="level-item">4 minutes read (About 668 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/06/02/book3-3/">XMLHttpRequest 와 Fetch API</a></h1><div class="content"><br/>

<h2 id="XMLHttpRequest"><a href="#XMLHttpRequest" class="headerlink" title="XMLHttpRequest"></a>XMLHttpRequest</h2><p>curl 커맨드의 기능을 자바스크립트로 사용할 수 있게 해주는 기능이 <code>XMLHttpRequest</code>이다. http 통신과 마찬가지로 클라이언트가 서버에 요청을 보내고, 그 응답으로 서버가 클라이언트에 데이터를 보낼 수 있다. <U>단, http처럼 서버 측에서 클라이언트에 요청을 보낼 수는 없다.</U>(?)</p>
<h3 id="XMLHttpRequest-와-브라우저의-http요청-차이"><a href="#XMLHttpRequest-와-브라우저의-http요청-차이" class="headerlink" title="XMLHttpRequest 와 브라우저의 http요청 차이"></a>XMLHttpRequest 와 브라우저의 http요청 차이</h3><ul>
<li>송수신할 때 html화면이 새로 고침되지 않는다.</li>
<li>GET과 POST 이외의 메서드도 전송할 수 있다.</li>
<li>폼의 경우 키와 값이 일대일이 되는 형식의 데이터만 전송할 수 있고, 응답은 브라우저로 표시되어 버리지만, 플레인텍스트,json,binary data,xml등 다양한 형식을 송수신할 수 있다.</li>
</ul>
<p>http의 경우, 파일 다운로드를 제외하면 서버의 응답을 받을 때는 화면이 일단 지워지고 브라우저 내에서 새로운 페이지가 렌더링된다. 하지만 XMLHttpRequest를 사용하면 자바스크립트 내에서 송수신이 완결되므로 화면이 지워지지 않아도 최신 정보를 가져올 수 있다. 이처럼 화면을 지우지않고 웹페이이지를 갱신할 수 있는 아키텍처를 ajax라고 한다.</p>
<h3 id="XMLHttpRequest의-보안"><a href="#XMLHttpRequest의-보안" class="headerlink" title="XMLHttpRequest의 보안"></a>XMLHttpRequest의 보안</h3><p>XMLHttpRequest의 보안 제어는 액세스할 수 있는 정보 제한과 전송 제한이라는 두가지 제한으로 구성된다.</p>
<p>액세스할 수 있는 정보의 제한으로는 쿠키가 있다. 스크립트로 document.cookie 속성에 엑세스하면 브라우저에서 여는 페이지에 관한 쿠키를 모두 읽을 수 있다. 이 때, <code>httponly</code> 속성을 쿠키에 부여하면, 스크립트로 액세스할 수 없어지므로 외부로 유출될 위험이 줄어든다.</p>
<p>전송 제한에는 도메인, 메서드, 헤더 세 종류가 있다. 스크립트로 어느 웹사이트에나 자유롭게 액세스할 수 있게 되면, 악의가 있는 웹사이트로 정보를 전송해 버릴 수 있다. 이를 방지하기 위해 기본적으로 브라우저 액세스하고 있는 호스트에만 접근할 수 있다. 그 밖의 사이트에 액세스하는 방법으로서 xmlhttprequest뿐만 아니라 브라우저에서 널리 이용되는 <a href="https://jyejin.github.io/2020/06/06/study1-2/">CORS</a>라는 액세스 제한 시스템이 있다.</p>
<h2 id="Fetch-API"><a href="#Fetch-API" class="headerlink" title="Fetch API"></a>Fetch API</h2><p><strong>&lt;리얼월드 HTTP&gt; 도서의 내용을 요약 정리한 것입니다.</strong></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-31T04:38:26.000Z" title="2020-05-31T04:38:26.000Z">2020-05-31</time><span class="level-item"><a class="link-muted" href="/categories/Book/">Book</a><span> / </span><a class="link-muted" href="/categories/Book/%EB%A6%AC%EC%96%BC%EC%9B%94%EB%93%9C-HTTP/">리얼월드 HTTP</a></span><span class="level-item">17 minutes read (About 2498 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/31/book3-2/">쿠키, 세션, 캐시</a></h1><div class="content"><br/>

<h1 id="콘텐트-니고시에이션"><a href="#콘텐트-니고시에이션" class="headerlink" title="콘텐트 니고시에이션"></a>콘텐트 니고시에이션</h1><p>서버와 클라이언트는 따로 개발되어 운용되므로 양쪽이 기대하는 형식이나 설정이 항상 일치한다고 할 수는 없다. 통신 방법을 최적화하고자 하나의 요청 안에서 서버와 클라이언트가 서로 최고의 설정을 공유하는 시스템을 콘텐트 니고시에이션이라고 한다.</p>
<p>니고시에이션에 사용하는 헤더는 다음 4개이다.</p>
<ul>
<li>Accept ⇒ MIME 타입</li>
<li>Accept-language ⇒ 표시 언어</li>
<li>Accept-charset ⇒ 문자의 문자셋</li>
<li>Accept-encoding ⇒ 바디 압축</li>
</ul>
<img src="/gallery/book3-2-1.png" >

<p>Accept에서 q는 품질 계수로 0~1까지의 값이다. 기본은 1.0이며, 우선 순위를 나타낸다. 우선 순위대로 파일 형식을 체크하고 지원하지 않으면 다음 우선 순위로 넘어가는 방식이다.</p>
<h1 id="쿠키"><a href="#쿠키" class="headerlink" title="쿠키"></a>쿠키</h1><p>쿠키란 웹사이트의 정보를 브라우저 쪽에 저장하는 작은 파일이다. 쿠키도 http 헤더를 기반으로 구현됐다. 서버에서는 다음과 같이 응답 헤더를 보낸다.</p>
<ul>
<li>Set-cookie: last_access_date=jul/31/2019</li>
</ul>
<p>HTTP는 스테이트리스(언제 누가 요청해도 요청이 같으면 결과가 같음)을 기본으로 개발 됐지만, 쿠키를 이용하면 서버가 상태를 유지하는 스테이트풀처럼 보이게 서비스를 제공할 수 있다.</p>
<h3 id="쿠키의-잘못된-사용법"><a href="#쿠키의-잘못된-사용법" class="headerlink" title="쿠키의 잘못된 사용법"></a>쿠키의 잘못된 사용법</h3><ol>
<li>영속성 문제 : 브라우저의 비밀모드, 보안 설정에 따라 세션이 끝나면 초기화 되거나 쿠키를 보관하라는 서버의 지시를 무시하기도 한다. 사라지더라도 문제가 없는 정보나 서버 정보로 복원할 수 있는 자료를 저장하는 용도에 적합하다.</li>
<li>용량 문제 : 쿠키의 최대 크기는 4kb 제한되어 있다.</li>
<li>보안 문제 : secure 속성을 부여하면 https프로토콜로 암호화된 통신에서만 쿠키가 전송되지만, http통신에서는 쿠키가 평문으로 전송된다. 매 요청 시 쿠키가 전송되는데 노출될 위험성이 있다. 정보를 넣을 때는 서명이나 암호화 처리가 필요하다.</li>
</ol>
<h3 id="쿠키에-제약을-주다"><a href="#쿠키에-제약을-주다" class="headerlink" title="쿠키에 제약을 주다"></a>쿠키에 제약을 주다</h3><p>Http클라이언트는 쿠키를 제어하는 속성을 해석해 쿠키 전송을 제어할 책임이 있다. 속성은 세미클론으로 구분해 얼마든지 나열할 수 있다.</p>
<img src="/gallery/book3-2-2.png">

<ul>
<li>Expires, max-age속성 : 쿠키의 수명을 설정한다. 각각 특정날짜와 초단위로 제한</li>
<li>Domain : 클라이언트에서 쿠키를 전송할 대상 서버. 생략하면 쿠키를 발행한 서버가 된다.</li>
<li>Secure : https로 프로토콜을 사용한 보안 접속일 때만 클라이언트에서 서버로 쿠키를 전송한다. Http접속일 때는 브라우저가 경고를 하고 접속하지 않아 정보 유출을 막는다.</li>
<li>Httponly : 자바스크립트 엔진으로부터 쿠키를 감출 수 있다.</li>
<li>Samesite : 크롬 브라우저에서 도입한 속성으로, 같은 오리진의 도메인에 전송하게 된다.</li>
</ul>
<h3 id="인증과-세션"><a href="#인증과-세션" class="headerlink" title="인증과 세션"></a>인증과 세션</h3><ul>
<li>Basic인증과 digest인증</li>
</ul>
<p>Basic인증은 유저명과 패스워드를 base64로 인코딩한 것이다. Base64는 복호화가 가능하므로 서버로부터 복원해 원래 유저명과 패스워드를 추출할 수 있다. 추출된 정보는 서버의 db와 비교해서 정상 사용자인지 검증한다. </p>
<p>Digest 인증은 해시함수를 이용한다. </p>
<h3 id="쿠키를-사용한-세션-관리"><a href="#쿠키를-사용한-세션-관리" class="headerlink" title="쿠키를 사용한 세션 관리"></a>쿠키를 사용한 세션 관리</h3><p>지금은 basic, digest인증 모두 거의 사용되지 않는다. 최근 많이 사용되는 방식은 폼을 이용한 로그인과 쿠키를 이용한 세션관리 조합이다. 설명하면,</p>
<ol>
<li>클라이언트는 폼으로 id,password를 전송한다.</li>
<li>Digest인증과 달리 직접 송신하므로 ssl/tls 방식이 필수다.</li>
<li>서버 측에서는 유저id와 패스워드로 인증하고 문제가 없으면 세션 토큰을 발행한다.</li>
<li>서버는 세션 토큰을 관계형 db나 키-밸류형 db에 저장해둔다. </li>
<li>토큰은 쿠키로 클라이언트에 되돌아간다. 두번째 이후 접속에서는 쿠키를 재전송해 로그인된 클라이언트임을 서버가 알 수 있다.</li>
</ol>
<h1 id="프록시"><a href="#프록시" class="headerlink" title="프록시"></a>프록시</h1><p>프록시는 http등의 통신을 중계한다. 때로는 중계만 하지 않고 각종 부가 기능을 구현한 경우도 있다. 또한 외부공격으로부터 네트워크를 보호하는 방화벽 역할도 한다. 중계되는 프록시는 중간의 호스트ip주소를 특정 헤더에 기록해 간다. </p>
<ul>
<li>X-forwarded-for: client, proxy1, proxy2…</li>
</ul>
<p>프록시와 비슷한 것으로는 게이트웨이가 있다. 이 둘은 http/1.0에서 다음과 같이 정의되어 있다.</p>
<ul>
<li>프록시 : 통신 내용을 이해한다. 필요에 따라서 콘텐츠를 수정하거나 대신 응답한다.</li>
<li>게이트 웨이: 통신 내용을 그대로 전송한다. 내용의 수정도 불허한다. 클라이언트에서는 중간에 존재하는 것을 알아채서는 안된다.</li>
</ul>
<h1 id="캐시"><a href="#캐시" class="headerlink" title="캐시"></a>캐시</h1><p>콘텐츠가 변경되지 않았을 땐 로컬에 저장된 파일을 재사용함으로써 다운로드 횟수를 줄이고 성능을 높인다. Get/head메서드 이외에는 캐시되지 않는다.</p>
<h3 id="갱신-일자에-따른-캐시"><a href="#갱신-일자에-따른-캐시" class="headerlink" title="갱신 일자에 따른 캐시"></a>갱신 일자에 따른 캐시</h3><p>기본적으로 last-modified가 있으면 콘텐츠를 캐시한다.</p>
<p>서버는 캐시 시간과 컨텐츠 갱신 일자를 비교해서 컨텐츠가 업데이트됐으면 200 ok를 반환하고 바디에 콘텐츠를 실어 보내지만, 업데이트 안됐으면 304 not modified를 반환하고 바디를 응답에 포함하지 않는다…!</p>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>앞서 설명한 갱신 일시를 이용하여 캐시하는 경우 캐시의 유효성을 확인하기 위한 통신이 발생한다. 이 통신 자체를 없애기 위해 헤더에 expires를 추가한다. Expires헤더에는 날짜와 시간이 들어간다. Expires기간 이내라면 캐시가 유효하다고 판단해 요청을 아예 전송하지 않는다. 지정한 기간 이내의 변경 사항은 모두 무시되기 때문에 좀처럼 변경되지 않는 정적 콘텐츠에 사용하는 것이 바람직하다.</p>
<h3 id="Pragma-no-cache"><a href="#Pragma-no-cache" class="headerlink" title="Pragma:no-cache"></a>Pragma:no-cache</h3><p>이 헤더는 프록시 서버에 요청한 컨텐츠가 이미 저장돼 있어도, 원래 서버에서 가려오라고 지시한다. No-cache는 http/1.1에 이르러 cache-contorl로 통합됐지만, 아직 남아 있다. 그다지 적극적으로 사용되지는 않는다.</p>
<h3 id="Etag추가"><a href="#Etag추가" class="headerlink" title="Etag추가"></a>Etag추가</h3><p>동적으로 바뀌는 요소가 늘어날수록 어떤 날짜를 근거로 캐시의 유효성을 판단해야 하는지 판단하기 어려워진다. Etag는 순차적인 갱신 일시가 아니라 파일의 해시값으로 비교한다. 일시를 이용해 확인할 때처럼 서버는 응답에 etag 헤더를 부여한다. 두번째 이후 다운로드 시 클라이언트는 if-none-match헤더에 다운로드된 캐시에 들어 있던 etag값을 추가해 요청한다. 서버는 보내려는 파일의 etag와 비교해서 같으면 304 not modified로 응답한다. 오호! Etag는 서버가 자유롭게 그 값을 정할 수 있다. 예를 들어 아마존s3의 경우 콘텐츠 파일의 해시 값이 사용된다. </p>
<h3 id="Cahce-control"><a href="#Cahce-control" class="headerlink" title="Cahce-control"></a>Cahce-control</h3><p>Etag와 같은시기에 1.1에 추가된 것이 cache-control헤더이다. Expires보다 우선해서 처리된다.</p>
<h1 id="리퍼러"><a href="#리퍼러" class="headerlink" title="리퍼러"></a>리퍼러</h1><p>리퍼러는 사용자가 어느 경로로 웹사이트에 도달했는지 서버가 파악할 수 있도록 클라이언트가 서버에 보내는 헤더이다. 웹서비스는 리퍼러 정보를 수집함으로써 어떤 페이지가 자신의 서비스에 링크를 걸었는지도 알 수 있다.</p>
<p>리퍼러 정책으로서 설정할 수 있는 값은 다음과 같다.</p>
<ul>
<li>No-referrer:전혀 보내지 않는다.</li>
<li>No-referrer-when-downgrade:기본 동작과 마찬가지로 https→http일 때는 전송하지 않는다.</li>
<li>Same-origin:동일 도메인 내의 링크에 대해서만 리퍼러를 전송한다.</li>
<li>Origin:상세 페이지가 아니라 톱페이지에서 링크된 것으로 해 도메인 이름만 전송한다.</li>
<li>Strict-origin:origin과 같지만 https→http일 때는 전송하지 않는다.</li>
<li>Origin-when-crossorigin: 같은 도메인내에서는 완전 리퍼러를, 다른 도메인에는 도메인 이름만 전송한다.</li>
<li>Unsafe-url: 항상 전송한다.</li>
</ul>
<h1 id="검색-엔진용-콘텐츠-접근-제어"><a href="#검색-엔진용-콘텐츠-접근-제어" class="headerlink" title="검색 엔진용 콘텐츠 접근 제어"></a>검색 엔진용 콘텐츠 접근 제어</h1><p>크롤러, 로봇, 봇, 스파이더와 같은 정보를 수집하는 자동 순회 프로그램이 많이 운용되게 되었다. 이 크롤러의 접근을 제어하는 방법으로는 주로 2가지 방법이 쓰인다.</p>
<ul>
<li>Robots.txt</li>
<li>사이트맵</li>
</ul>
<h3 id="Robots-txt"><a href="#Robots-txt" class="headerlink" title="Robots.txt"></a>Robots.txt</h3><p>Robots.txt는 서버 콘텐츠 제공자가 크롤러에 접근 허가 여부를 전하기 위한 프로토콜이다. 파일 내에서는 읽기를 금지할 크롤러의 이름과 장소를 지정한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent:*</span><br><span class="line">Disallow:&#x2F;cgi-bin&#x2F;</span><br><span class="line">Disallow:&#x2F;tmp&#x2F;</span><br></pre></td></tr></table></figure>

<p>Robots.txt가 블랙리스트처럼 사용된다면, 사이트맵은 화이트리스트처럼 사용된다..</p>
<p><strong>&lt;리얼월드 HTTP&gt; 도서의 내용을 요약 정리한 것입니다.</strong></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-22T06:51:52.000Z" title="2020-05-22T06:51:52.000Z">2020-05-22</time><span class="level-item"><a class="link-muted" href="/categories/Book/">Book</a><span> / </span><a class="link-muted" href="/categories/Book/%EB%A6%AC%EC%96%BC%EC%9B%94%EB%93%9C-HTTP/">리얼월드 HTTP</a></span><span class="level-item">10 minutes read (About 1561 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/22/book3-1/">헤더와 바디</a></h1><div class="content"><br/>

<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>HTTP는 웹 브라우저와 웹 서버가 통신하는 절차와 형식을 규정한 것이다. 더 나아가 번역 api나, 데이터 저장 api등 다양한 서비스의 인터페이스로 사용되면서 인터넷의 기초가 됐다.</p>
<p>다양한 프로토콜이 RFC로 정의됐다. RFC는 통신의 상호접속성 유지를 위한 공통화된 사양서 모음을 의미한다.</p>
<h3 id="HTTP-헤더"><a href="#HTTP-헤더" class="headerlink" title="HTTP 헤더"></a>HTTP 헤더</h3><p>헤더는 <code>파일명:값</code> 형식으로 본문 앞에 부가된다. 헤더 이름은 대, 소문자를 구별하지 않는다. http에도 이 전자메일과 같은 똑같은 형식의 헤더가 도입됐다.</p>
<h4 id="1-클라이언트가-서버에-보내는-헤더"><a href="#1-클라이언트가-서버에-보내는-헤더" class="headerlink" title="1. 클라이언트가 서버에 보내는 헤더"></a>1. 클라이언트가 서버에 보내는 헤더</h4><p>• User-Agent : 클라이언트가 자신의 애플리케이션 정보를 나타내는 곳. 스마트폰, pc의 브라우저 종류나 버전을 구분할 수 있다.</p>
<p>• Referer : 서버에서 참고하는 추가 정보. 클라이언트가 요청을 보낼 때 보고 있던 페이지의 url을 보낸다. 페이지의 참조원을 서버가 참조하하는데 이용한다.</p>
<p>• Authorization: 특별한 클라이언트에만 통신을 허가할 때, 인증 정보를 서버에 전달한다. aws나 git api등에서는 웹 서비스 자체 표기를 요구하기도 한다(?)</p>
<h4 id="2-서버에서-클라이언트로-보낼-때-부여하는-헤더"><a href="#2-서버에서-클라이언트로-보낼-때-부여하는-헤더" class="headerlink" title="2. 서버에서 클라이언트로 보낼 때 부여하는 헤더"></a>2. 서버에서 클라이언트로 보낼 때 부여하는 헤더</h4><p>• Contet-Type : 파일 종류를 지정. mime 타입이라는 식별자를 기술한다.</p>
<p>• Content-Length : 바디 크기. 만약 압축이 이루어지는 경우 압축 후의 크기가 들어간다.</p>
<p>• Content-Encoding : 압축이 이루어진 경우, 압축 형식을 설명한다.</p>
<p>• Date : 문서 날짜</p>
<p>• 또한 이 밖에 X-로 시작되는 헤더는 각 애플리케이션이 자유롭게 사용해도 된다.</p>
<h3 id="헤더의-전송"><a href="#헤더의-전송" class="headerlink" title="헤더의 전송"></a>헤더의 전송</h3><p>curl 커맨드로 실제 헤더를 보낼 수 있다. 헤더는 —header=헤더행 or -H옵션을 사용한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl —http1.0 -H “X-test: hello” http//localhost:8000</span><br></pre></td></tr></table></figure>
<h3 id="MIME-타입"><a href="#MIME-타입" class="headerlink" title="MIME 타입"></a>MIME 타입</h3><p>파일의 종류를 구분하는 문자열.</p>
<p>인터넷 옵션에 따라 mime타입이 아닌 내용을 보고 파일 형식을 추측하려 하는데 이런 동작을 콘텐츠 스니핑이라고 한다. 그런데 만약 text파일에 html, js가 써있으면 파일을 실행해버리는 문제가 생길 수도 있다. 이런 문제를 해결하기 위해서 다음과 같이 옵션을 추가한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-content-type-option: nosniff</span><br></pre></td></tr></table></figure>

<h3 id="메서드"><a href="#메서드" class="headerlink" title="메서드"></a>메서드</h3><p>http/1.0으로 통신할 때 전송되는 get부분은 메서드로 불린다. 다음 3가지가 흔히 쓰이는 메서드이다.</p>
<p>• get : 서버에 헤더와 콘텐츠 요청</p>
<p>• head: 서버에 헤더만 요청</p>
<p>• post : 새로운 문서 투고</p>
<p>html의 폼에서는 get과 post만 지원된다.</p>
<h3 id="스테이터스-코드"><a href="#스테이터스-코드" class="headerlink" title="스테이터스 코드"></a>스테이터스 코드</h3><p>3자리 숫자를 보고 서버가 어떻게 응답했는지 파악한다.</p>
<p>• 100번대 : 처리가 계속됨을 나타낸다.</p>
<p>• 200번대 : 성공했을 때의 응답.</p>
<p>• 300번대 : 서버에서 클라이언트로의 명령. 정상 처리의 범주이며 리디렉트나 캐시 이용을 지시한다.</p>
<p>• 400번대 : 클라이언트가 보낸 요청에 오류가 있다.</p>
<p>• 500번대 : 서버 내부에서 오류가 발생했다.</p>
<h3 id="리디렉트"><a href="#리디렉트" class="headerlink" title="리디렉트"></a>리디렉트</h3><p>서버는 브라우저에 대해 리디렉트하도록 지시할 수 있다. 300이외의 경우는 <strong>location</strong>헤더를 사용해 리디렉트할 곳을 서버에서 클라이언트로 전달한다. 리디렉트에는 다섯 가지 종류가 있다.</p>
<p>• 301 moved permanently : 도메인 전송, 웹사이트 이전, https</p>
<p>• 302 found : 일시적 관리, 모바일 기반 전송</p>
<p>• 303 see other : 로그인 후 페이지 전환</p>
<p>• 307 temporary redirect: ..</p>
<p>영구적인지 일시적인지는 이동하는 이전 페이지가 이후에도 존재하는지로 분류한다. http → https 로의 전환은 http를 볼 일이 없으므로 영구적이다.</p>
<p>클라이언트는 Location헤더 값을 보고 다시 요청한다.</p>
<h3 id="Url"><a href="#Url" class="headerlink" title="Url"></a>Url</h3><p>Uri에는 urn이라는 이름 부여 규칙도 포함된다. url은 장소로 문서 등의 리소스를 특정하는 수단을 제공한다. 다시 말해, url은 주소이며, urn은 이름 그 자체이다. urn 예시는 다음과 같다.</p>
<p>웹 시스템을 다루는 한 urn이 등장할 일은 없으므로 uri와 url은 거의 같다.</p>
<h3 id="url의-구조"><a href="#url의-구조" class="headerlink" title="url의 구조"></a>url의 구조</h3><p>스키마://호스트명/경로</p>
<p>• 스키마 : https</p>
<p>• 호스트명: <a href="http://www.oreilly.co.jp/">www.oreilly.co.jp</a></p>
<p>• 경로: index.html</p>
<p>Url 사양에 포함되는 모든 요소가 들어간다면, 다음과 같은 형식이 된다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">스키마:&#x2F;&#x2F;사용자:패스워드@호스트명:포트&#x2F;경로#프래그먼트?쿼리</span><br></pre></td></tr></table></figure>

<p>사용자 이름과 패스워드는 FTP등에서 사용되곤 하는데, 여기서 기술하는 방식은 basic인증으로, 패스워드가 그대로 노출되어 웹 시스템에서 사용되는 일은 없다.</p>
<p>프래그먼트는 html에서는 페이지 내 링크의 앵커를 지정하는 데 쓰인다.</p>
<p>쿼리는 검색 용어를 지정하거나 표시하고 싶은 웹페이지에 대해서 특정 파라미터를 부여하는 데 쓰인다.</p>
<p>처음에는 url의 도메인 이름을 영숫자와 하이픈만 쓸 수 있었지만, 국제화 도메인 네임을 표현하는 인코딩 규칙 퓨니코드가 정해져 다국어를 사용할 수 있게 되었다.</p>
<h3 id="바디"><a href="#바디" class="headerlink" title="바디"></a>바디</h3><p>헤더 마지막 줄에 빈 줄을 넣으면 그 이후는 모두 바디가 된다. 한 번 응답할 때마다 한 파일만 반환한다. 폼이나 xmlhttprequest를 사용해 클라이언트에서 서버로 데이터를 전송하는 경우도 있다.</p>
<p><strong>&lt;리얼월드 HTTP&gt; 도서의 내용을 요약 정리하고 관련 내용을 추가하였습니다.</strong></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-12T09:28:10.000Z" title="2020-05-12T09:28:10.000Z">2020-05-12</time><span class="level-item"><a class="link-muted" href="/categories/Project/">Project</a><span> / </span><a class="link-muted" href="/categories/Project/DeepLearningFromForR/">DeepLearningFromForR</a></span><span class="level-item">7 minutes read (About 1107 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/12/project1-4/">역전파를 사용하여 모델 학습하기</a></h1><div class="content"><br/>

<p>오차역전파를 사용한 학습도 손실함수를 최소화하는 가중치를 찾는 것을 목표로합니다. 다만, 역전파는 가중치를 구함에 있어 연쇄법칙에 기반한 국소적 미분을 활용합니다. 순전파와 비교했을 때 훨씬 빠른 시간 안에 효울적으로 계산한다는 장점이 있습니다. 이번에는 역전파법을 사용하여 모델 학습을 진행해 보겠습니다.</p>
<p>먼저, 라이브러리와 공통함수를 읽어옵니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install.packages("dslabs")</span></span><br><span class="line">    <span class="keyword">library</span>(dslabs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">source</span>(<span class="string">"./functions.R"</span>)</span><br><span class="line">    <span class="keyword">source</span>(<span class="string">"./utils.R"</span>)</span><br><span class="line">    <span class="keyword">source</span>(<span class="string">"./model.R"</span>)</span><br></pre></td></tr></table></figure>

<p>1개의 은닉층을 갖는 네트워크를 생성합니다. 네트워크는 순전파와 동일합니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TwoLayerNet &lt;- <span class="keyword">function</span>(input_size, hidden_size, output_size, weight_init_std  =  <span class="number">0.01</span>) &#123;</span><br><span class="line">  W1 &lt;- weight_init_std * matrix(rnorm(n  =  input_size*hidden_size), nrow  =  input_size, ncol  =  hidden_size)</span><br><span class="line">  b1 &lt;- matrix(rep(<span class="number">0</span>,hidden_size), nrow = <span class="number">1</span>, ncol = hidden_size)</span><br><span class="line">  W2 &lt;- weight_init_std * matrix(rnorm(n  =  hidden_size*output_size), nrow  =  hidden_size, ncol  =  output_size)</span><br><span class="line">  b2 &lt;- matrix(rep(<span class="number">0</span>,output_size),nrow = <span class="number">1</span>, ncol = output_size)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (list(W1 = W1, b1 = b1, W2 = W2, b2 = b2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>데이터를 불러와 트레이닝셋과 테스트셋으로 분리하는 <code>init()</code>함수를 생성합니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">init &lt;- <span class="keyword">function</span>()&#123;</span><br><span class="line">  mnist_data &lt;- get_data()</span><br><span class="line">  <span class="comment">#손글씨 데이터</span></span><br><span class="line">  x_train_normalize &lt;&lt;- mnist_data$x_train </span><br><span class="line">  x_test_normalize &lt;&lt;- mnist_data$x_test</span><br><span class="line">  <span class="comment">#정답 레이블</span></span><br><span class="line">  t_train_onehotlabel &lt;&lt;- making_one_hot_label(mnist_data$t_train,<span class="number">60000</span>, <span class="number">10</span>)</span><br><span class="line">  t_test_onehotlabel &lt;&lt;- making_one_hot_label(mnist_data$t_test,<span class="number">10000</span>, <span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>앞서 역전파에서는 국소적 미분을 사용한다고 했습니다. 순전파와 반대방향으로 국소적 미분을 곱하여 이전 노드들에 값을 전달하는 것인데, 국소적 미분은 순전파 때의 미분을 구한다는 뜻입니다. 다시 말해, 순전파 때의 미분 값을 구해 다음 노드에 전달하는 함수가 필요합니다.<br>다음 코드는 순전파 때와 마찬가지로 입력신호와 가중치를 계산하고 Relu함수를 거쳐 다음 노드로 전달합니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">forward &lt;- <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  Affine_1 &lt;- Affine.forward(network$W1, network$b1, x)</span><br><span class="line">  Relu_1 &lt;- Relu.forward(Affine_1$out)</span><br><span class="line">  Affine_2 &lt;- Affine.forward(network$W2, network$b2, Relu_1$out)</span><br><span class="line">  <span class="keyword">return</span>(list(x = Affine_2$out, Affine_1.forward = Affine_1, Affine_2.forward = Affine_2, Relu_1.forward = Relu_1))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>역전파도 마찬가지로 손실함수를 계산합니다. </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">loss &lt;- <span class="keyword">function</span>(model.forward, x, t)&#123;</span><br><span class="line">  temp &lt;- model.forward(x)</span><br><span class="line">  y &lt;- temp$x</span><br><span class="line">  last_layer.forward &lt;- SoftmaxWithLoss.forward(y, t)</span><br><span class="line">  <span class="keyword">return</span>(list(loss = last_layer.forward$loss, softmax = last_layer.forward, predict =  temp))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>순전파와 달리 마지막 노드에서부터 거꾸로 계산해 기울기를 구합니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gradient &lt;- <span class="keyword">function</span>(model.forward, x, t) &#123;</span><br><span class="line">  <span class="comment"># 순전파</span></span><br><span class="line">  temp &lt;- loss(model.forward, x, t)</span><br><span class="line">  <span class="comment"># 역전파</span></span><br><span class="line">  dout &lt;- <span class="number">1</span></span><br><span class="line">  last.backward &lt;- SoftmaxWithLoss.backward(temp$softmax, dout)</span><br><span class="line">  Affine_2.backward &lt;- Affine.backward(temp$predict$Affine_2.forward, dout  =  last.backward$dx)</span><br><span class="line">  Relu_1.backward &lt;- Relu.backward(temp$predict$Relu_1.forward, dout  =  Affine_2.backward$dx)</span><br><span class="line">  Affine_1.backward &lt;- Affine.backward(temp$predict$Affine_1.forward, dout  =  Relu_1.backward$dx)</span><br><span class="line">  grads  &lt;- list(W1  =  Affine_1.backward$dW, b1  =  Affine_1.backward$db, W2  =  Affine_2.backward$dW, b2  =  Affine_2.backward$db)</span><br><span class="line">  <span class="keyword">return</span>(grads)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>다음은 학습을 실제로 진행하는 코드입니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">train_model &lt;- <span class="keyword">function</span>(batch_size, iters_num, learning_rate, debug=<span class="literal">FALSE</span>)&#123;</span><br><span class="line">  <span class="comment">#seperate train, test data</span></span><br><span class="line">  init()</span><br><span class="line">  train_size &lt;- dim(x_train_normalize)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  iter_per_epoch &lt;- max(train_size / batch_size)</span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:iters_num)&#123;</span><br><span class="line">      batch_mask &lt;- sample(train_size ,batch_size)</span><br><span class="line">      x_batch &lt;- x_train_normalize[batch_mask,]</span><br><span class="line">      t_batch &lt;- t_train_onehotlabel[batch_mask,]</span><br><span class="line"></span><br><span class="line">      grad &lt;- gradient(model.forward=forward, x_batch, t_batch)</span><br><span class="line">      <span class="comment">#update weights and biases using SGD</span></span><br><span class="line">      network &lt;&lt;- sgd.update(network,grad,lr=learning_rate)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(debug == <span class="literal">TRUE</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>(i %% iter_per_epoch == <span class="number">0</span>)&#123;</span><br><span class="line">              train_acc &lt;- model.evaluate(forward, x_train_normalize, t_train_onehotlabel)</span><br><span class="line">              test_acc &lt;- model.evaluate(forward, x_test_normalize, t_test_onehotlabel)</span><br><span class="line">              print(c(train_acc, test_acc))</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  train_accuracy = model.evaluate(forward, x_train_normalize, t_train_onehotlabel)</span><br><span class="line">  test_accuracy = model.evaluate(forward, x_test_normalize, t_test_onehotlabel)</span><br><span class="line">  <span class="keyword">return</span>(c(train_accuracy, test_accuracy))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>train_model()</code>함수 중간에 <code>sg.update()</code>함수는 경사하강법으로 변경된 가중치를 업데이트하는 역할을 합니다.<br>코드는 아래와 같습니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sgd.update &lt;- <span class="keyword">function</span>(network, grads, lr = <span class="number">0.01</span>)&#123;</span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> names(network))&#123;network[[i]] &lt;- network[[i]] - (grads[[i]]*lr)&#125;</span><br><span class="line">  <span class="keyword">return</span>(network)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 모든 준비를 마쳤습니다. 네트워크를 생성한 후 모델을 학습시켜봅니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">network &lt;&lt;- TwoLayerNet(input_size = <span class="number">784</span>, hidden_size = <span class="number">50</span>, output_size = <span class="number">10</span>)</span><br><span class="line">train_model(<span class="number">100</span>, <span class="number">10000</span>, <span class="number">0.1</span>, <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure>

<p>위 코드를 실행시키고 3분 정도 지나면 아래와 같은 출력화면이 나올 것입니다. 한 행의 첫 번째 숫자는 훈련데이터 셋에 대한 정확도, 두 번째 숫자는 테스트 셋에 대한 정확도를 나타냅니다. 그리고 하나의 행은 1에폭(epoch)을 의미합니다. 에폭을 진행할수록 정확도가 높아지는 것을 확인할 수 있습니다!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] <span class="number">0.9048</span> <span class="number">0.9059</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9228</span> <span class="number">0.9247</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9355833</span> <span class="number">0.9343000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9436167</span> <span class="number">0.9416000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9496167</span> <span class="number">0.9470000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9563167</span> <span class="number">0.9519000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9602167</span> <span class="number">0.9555000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9629167</span> <span class="number">0.9558000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9664833</span> <span class="number">0.9603000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9680333</span> <span class="number">0.9619000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9711167</span> <span class="number">0.9635000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.97315</span> <span class="number">0.96520</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.97445</span> <span class="number">0.96570</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9754167</span> <span class="number">0.9659000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9771167</span> <span class="number">0.9698000</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9779</span> <span class="number">0.9679</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9776833</span> <span class="number">0.9680000</span></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-04T04:30:25.000Z" title="2020-05-04T04:30:25.000Z">2020-05-04</time><span class="level-item"><a class="link-muted" href="/categories/Project/">Project</a><span> / </span><a class="link-muted" href="/categories/Project/DeepLearningFromForR/">DeepLearningFromForR</a></span><span class="level-item">7 minutes read (About 1073 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/04/project1-3/">순전파를 사용하여 모델 학습하기</a></h1><div class="content"><br/>
순전파법을 사용하여 손글씨 추론 모델을 만들어보겠습니다. 순전파법의 기본 원리는 손실함수 값을 최소화 시키는 것입니다. 손실함수 값을 최소화 시키는 방법으로는 경사하강법(SGD)를 사용합니다. 순전파의 기본 설명은 다음 링크를 참고하세요.

<ul>
<li><a href="https://jyejin.github.io/2020/04/11/book1-3/">신경망 학습하기-1 (손실함수, 교차엔트로피오차)</a></li>
<li><a href="https://jyejin.github.io/2020/04/11/book1-4/">CH5. 신경망 학습하기-2 (경사하강법)</a></li>
</ul>
<p>먼저, 학습할 네트워크를 만듭니다. W1,W2는 각 층별 가중치이며 b1,b2는 편향 값을 의미합니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TwoLayerNet &lt;- <span class="keyword">function</span>(input_size, hidden_size, output_size, weight_init_std  =  <span class="number">0.01</span>) &#123;</span><br><span class="line">  W1 &lt;- weight_init_std * matrix(rnorm(n  =  input_size*hidden_size), nrow  =  input_size, ncol  =  hidden_size)</span><br><span class="line">  b1 &lt;- matrix(rep(<span class="number">0</span>,hidden_size), nrow = <span class="number">1</span>, ncol = hidden_size)</span><br><span class="line">  W2 &lt;- weight_init_std * matrix(rnorm(n  =  hidden_size*output_size), nrow  =  hidden_size, ncol  =  output_size)</span><br><span class="line">  b2 &lt;- matrix(rep(<span class="number">0</span>,output_size),nrow = <span class="number">1</span>, ncol = output_size)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (list(W1 = W1, b1 = b1, W2 = W2, b2 = b2))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>TwoLayerNet</code> 네트워크는 아래와 같이 은닉층을 1개 갖습니다.</p>
<img src="/gallery/project1-3-1.png">

<p>입력층에서 <code>input_size</code> 개수만큼의 노드를 갖고 은닉층에서는 <code>hidden_size</code> 개수만큼의 노드, 출력층에서는 <code>output_size</code>만큼의 노드를 갖습니다. <code>W1</code>과 <code>b1</code>은 입력층에서 은닉층으로 갈 때의 가중치와 편향이며 <code>W2</code>와 <code>b2</code>는 은닉층에서 출력층으로 갈 때 사용하는 가중치와 편향입니다. 그리고 <code>weight_init_std</code>는 가중치 초기값이 큰 값이 되는 것을 방지하는 파라미터입니다.</p>
<p>다음으로, 데이터를 불러오고 트레이닝 셋과 테스트 셋으로 분류합니다. 데이터는 MNIST 라이브러리의 손글씨 이미지입니다. R에서는 dslabs를 임포트합니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(dslabs)</span><br><span class="line"><span class="keyword">source</span>(<span class="string">"./functions.R"</span>)</span><br><span class="line"><span class="keyword">source</span>(<span class="string">"./utils.R"</span>)</span><br><span class="line"><span class="keyword">source</span>(<span class="string">"./model.R"</span>)</span><br><span class="line"></span><br><span class="line">init &lt;- <span class="keyword">function</span>()&#123;</span><br><span class="line">  mnist_data &lt;- get_data()</span><br><span class="line">  <span class="comment">#손글씨 데이터</span></span><br><span class="line">  x_train_normalize &lt;&lt;- mnist_data$x_train </span><br><span class="line">  x_test_normalize &lt;&lt;- mnist_data$x_test</span><br><span class="line">  <span class="comment">#정답 레이블</span></span><br><span class="line">  t_train_onehotlabel &lt;&lt;- making_one_hot_label(mnist_data$t_train,<span class="number">60000</span>, <span class="number">10</span>)</span><br><span class="line">  t_test_onehotlabel &lt;&lt;- making_one_hot_label(mnist_data$t_test,<span class="number">10000</span>, <span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>손실함수는 교차엔트로피오차 함수를 사용합니다. 교차엔트로피오차 함수는 아래와 같이 구현합니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">model.forward &lt;- <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  z1 &lt;- sigmoid(sweep((x %*% network$W1),<span class="number">2</span>, network$b1,<span class="string">'+'</span>))</span><br><span class="line">  <span class="keyword">return</span>(softmax(sweep((z1 %*% network$W2),<span class="number">2</span>, network$b2,<span class="string">'+'</span>)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cross_entropy_error &lt;- <span class="keyword">function</span>(y, t)&#123;</span><br><span class="line">    delta &lt;- <span class="number">1e-7</span></span><br><span class="line">    batchsize &lt;- dim(y)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span>(-sum(t * log(y + delta))/batchsize)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loss &lt;-<span class="keyword">function</span>(x,t)&#123;</span><br><span class="line">  <span class="keyword">return</span>(cross_entropy_error(model.forward(x),t))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>기본 교차엔트로피 함수식에 <code>delta</code>값을 추가하였는데, 이는 log0이 되면 -Inf가 되는 문제를 방지하기 위해서 입니다.</p>
<p>다음으로 경사하강법은 손실함수 값을 최소화 시키기 위해 사용합니다. </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">numerical_gradient_W &lt;- <span class="keyword">function</span>(f,x,t,weight)&#123;</span><br><span class="line">    h &lt;- <span class="number">1e-4</span></span><br><span class="line">    vec &lt;- matrix(<span class="number">0</span>, nrow = nrow(network[[weight]]) ,ncol = ncol(network[[weight]]))</span><br><span class="line">    <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:length(network[[weight]]))&#123;</span><br><span class="line">        origin &lt;-  network[[weight]][i]</span><br><span class="line">        network[[weight]][i] &lt;&lt;- (network[[weight]][i] + h)</span><br><span class="line">        fxh1 &lt;- f(x, t)</span><br><span class="line">        network[[weight]][i] &lt;&lt;- (network[[weight]][i] - (<span class="number">2</span>*h))</span><br><span class="line">        fxh2 &lt;- f(x, t)</span><br><span class="line">        vec[i] &lt;- (fxh1 - fxh2) / (<span class="number">2</span>*h)</span><br><span class="line">        network[[weight]][i] &lt;&lt;- origin</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>(vec)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">numerical_gradient &lt;- <span class="keyword">function</span>(f,x,t) &#123;</span><br><span class="line">  grads  &lt;- list(W1 = numerical_gradient_W(f,x,t,<span class="string">"W1"</span>), </span><br><span class="line">                 b1 = numerical_gradient_W(f,x,t,<span class="string">"b1"</span>), </span><br><span class="line">                 W2 = numerical_gradient_W(f,x,t,<span class="string">"W2"</span>), </span><br><span class="line">                 b2 = numerical_gradient_W(f,x,t,<span class="string">"b2"</span>))</span><br><span class="line">  <span class="keyword">return</span>(grads)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>마지막으로 학습시키는 함수입니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">train_model &lt;- <span class="keyword">function</span>(batch_size, iters_num, learning_rate, debug=<span class="literal">FALSE</span>)&#123;</span><br><span class="line">  <span class="comment">#seperate train, test data</span></span><br><span class="line">  init()</span><br><span class="line">  train_size &lt;- dim(x_train_normalize)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  iter_per_epoch &lt;- max(train_size / batch_size)</span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:iters_num)&#123;</span><br><span class="line">    batch_mask &lt;- sample(train_size,batch_size)</span><br><span class="line">    x_batch &lt;- x_train_normalize[batch_mask,]</span><br><span class="line">    t_batch &lt;- t_train_onehotlabel[batch_mask,]</span><br><span class="line"></span><br><span class="line">    grad &lt;- numerical_gradient(loss, x_batch, t_batch)</span><br><span class="line">    network &lt;&lt;- sgd.update(network,grad,lr=learning_rate)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i %% iter_per_epoch == <span class="number">0</span>)&#123;</span><br><span class="line">            train_acc &lt;- model.evaluate(model.forward, x_train_normalize, t_train_onehotlabel)</span><br><span class="line">            test_acc &lt;- model.evaluate(model.forward, x_test_normalize, t_test_onehotlabel)</span><br><span class="line">            print(c(train_acc, test_acc))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    train_accuracy = model.evaluate(model.forward, x_train_normalize, t_train_onehotlabel)</span><br><span class="line">    test_accuracy = model.evaluate(model.forward, x_test_normalize, t_test_onehotlabel)</span><br><span class="line">    <span class="keyword">return</span>(c(train_accuracy, test_accuracy))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>train_model()</code>함수 중간에 <code>sg.update()</code>함수는 경사하강법으로 변경된 가중치를 업데이트하는 역할을 합니다.<br>코드는 아래와 같습니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sgd.update &lt;- <span class="keyword">function</span>(network, grads, lr = <span class="number">0.01</span>)&#123;</span><br><span class="line">  <span class="keyword">for</span>(i <span class="keyword">in</span> names(network))&#123;network[[i]] &lt;- network[[i]] - (grads[[i]]*lr)&#125;</span><br><span class="line">  <span class="keyword">return</span>(network)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 모든 준비를 마쳤습니다. 네트워크를 생성한 후 모델을 학습시켜봅니다.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">network &lt;&lt;- TwoLayerNet(input_size = <span class="number">784</span>, hidden_size = <span class="number">50</span>, output_size = <span class="number">10</span>)</span><br><span class="line">train_model(<span class="number">100</span>, <span class="number">10000</span>, <span class="number">0.1</span>, <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure>



</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-04T03:45:55.000Z" title="2020-05-04T03:45:55.000Z">2020-05-04</time><span class="level-item"><a class="link-muted" href="/categories/Project/">Project</a><span> / </span><a class="link-muted" href="/categories/Project/Roadmap2020/">Roadmap2020</a></span><span class="level-item">a few seconds read (About 47 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/04/project2-1/">게시글</a></h1><div class="content"><br/>

<h3 id="5월-게시글"><a href="#5월-게시글" class="headerlink" title="5월 게시글"></a>5월 게시글</h3><ol>
<li><a href="https://jyejin.github.io/2020/05/01/study1/#more">DNS와 작동원리</a></li>
<li><a href="https://jyejin.github.io/2020/05/22/book3-1/">HTTP 1장</a></li>
<li><a href="https://jyejin.github.io/2020/05/31/book3-2/">HTTP 2장</a></li>
</ol>
<h3 id="6월-게시글"><a href="#6월-게시글" class="headerlink" title="6월 게시글"></a>6월 게시글</h3><ol>
<li><a href="https://jyejin.github.io/2020/06/02/book3-3/">HTTP 5장</a></li>
<li><a href="https://jyejin.github.io/2020/06/06/study1-2/">CORS</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-01T05:08:44.000Z" title="2020-05-01T05:08:44.000Z">2020-05-01</time><span class="level-item"><a class="link-muted" href="/categories/Study/">Study</a><span> / </span><a class="link-muted" href="/categories/Study/Network/">Network</a></span><span class="level-item">9 minutes read (About 1336 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/01/study1/">DNS와 작동원리</a></h1><div class="content"><br/>

<p>DNS는 Domanin Name System의 약자로, IP주소를 도메인으로 변환하고 도메인을 IP주소로 변환함으로써 통신하게 하는 시스템입니다.<br>온라인 상의 네트워킹을 하는 모든 단말은 IP주소를 갖고 있고 이 IP를 통해 서로 통신합니다.</p>
<ul>
<li>참고: IP주소는 인터넷에 <a href="https://search.naver.com/search.naver?sm=top_hty&fbm=0&ie=utf8&query=%EB%82%B4+IP">내 IP</a>라고 검색하면 확인할 수 있습니다. </li>
</ul>
<p>IP주소는 숫자로 되어있기 때문에 이를 하나씩 기억하고 사용하기란 매우 불편합니다. 그래서 IP주소에 도메인 네임을 붙여서 통신하게 합니다. 네이버에 접근할 때, IP주소가 아닌 <a href="http://www.naver.com">www.naver.com</a> 이라고 치는 것처럼 말이죠.<br>여기서 <code>naver.com</code>이 네이버의 도메인입니다. 도메인의 IP주소는 <code>nslookup</code>명령어로 확인할 수 있습니다. </p></div><a class="article-more button is-small size-small" href="/2020/05/01/study1/#more">Read More</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-01T04:18:29.000Z" title="2020-05-01T04:18:29.000Z">2020-05-01</time><span class="level-item"><a class="link-muted" href="/categories/Project/">Project</a><span> / </span><a class="link-muted" href="/categories/Project/Roadmap2020/">Roadmap2020</a></span><span class="level-item">a minute read (About 222 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/01/project2/">2020 개발자 로드맵 따라가기 프로젝트!</a></h1><div class="content"><br/>

<p>이것저것 구글링을 하다가 프론트엔드,백엔드,데브옵스 개발자를 위한 로드맵이 있다는 것을 알게 되었습니다. 무엇을 공부할지, 무엇부터 공부할지, 그리고 내가 부족한게 무엇인지 잘 모르겠다면 이 로드맵을 한번 훑어보시는걸 추천드립니다. 로드맵을 살펴보니 들어는 봤어도 개념을 명확하게 모르는게 많더라구요 ㅠ.ㅠ 그래서 저도 로드맵을 따라 공부해보려 합니다!<br>저는 프론트엔드 로드맵 1/3, 백엔드 로드맵 1/3부터 공부해 나갈 예정입니다. 공부 내용은 블로그에 올리도록 하겠습니다. 같이 공부해요.:)</p>
<p>로드맵 링크 : <a href="https://github.com/devJang/developer-roadmap">https://github.com/devJang/developer-roadmap</a><br>로드맵 공부 : <a href="https://roadmap.sh/frontend/resources">https://roadmap.sh/frontend/resources</a></p>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/tags/project/page/0/">Previous</a></div><div class="pagination-next"><a href="/tags/project/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/tags/project/">1</a></li><li><a class="pagination-link" href="/tags/project/page/2/">2</a></li></ul></nav></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3"><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Book/"><span class="level-start"><span class="level-item">Book</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Book/%EB%A6%AC%EC%96%BC%EC%9B%94%EB%93%9C-HTTP/"><span class="level-start"><span class="level-item">리얼월드 HTTP</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Book/%EB%B0%91%EB%B0%94%EB%8B%A5%EB%B6%80%ED%84%B0-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-%EB%94%A5%EB%9F%AC%EB%8B%9D/"><span class="level-start"><span class="level-item">밑바닥부터 시작하는 딥러닝</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Book/%EC%9D%B8%EC%82%AC%EC%9D%B4%EB%93%9C-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8/"><span class="level-start"><span class="level-item">인사이드 자바스크립트</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Project/"><span class="level-start"><span class="level-item">Project</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Project/DeepLearningFromForR/"><span class="level-start"><span class="level-item">DeepLearningFromForR</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Project/Roadmap2020/"><span class="level-start"><span class="level-item">Roadmap2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Study/"><span class="level-start"><span class="level-item">Study</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Study/ETC/"><span class="level-start"><span class="level-item">ETC</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Study/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-09T08:30:05.000Z">2020-08-09</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/09/project-3/">pytest 사용기 - fixture, scope</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Study/">Study</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-04T05:14:56.000Z">2020-07-04</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/04/study2-2/">&lt;클린 코드&gt; 좋았던 내용 기록하기(7-12장)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Study/">Study</a> / <a class="link-muted" href="/categories/Study/ETC/">ETC</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-14T06:30:33.000Z">2020-06-14</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/14/study2-1/">&lt;클린 코드&gt; 좋았던 내용 기록하기(1-3장)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Study/">Study</a> / <a class="link-muted" href="/categories/Study/ETC/">ETC</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-06T05:43:06.000Z">2020-06-06</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/06/study1-2/">CORS(Cross Origin Resource Sharing)</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Study/">Study</a> / <a class="link-muted" href="/categories/Study/Network/">Network</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-02T05:29:56.000Z">2020-06-02</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/02/book3-3/">XMLHttpRequest 와 Fetch API</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Book/">Book</a> / <a class="link-muted" href="/categories/Book/%EB%A6%AC%EC%96%BC%EC%9B%94%EB%93%9C-HTTP/">리얼월드 HTTP</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/book/"><span class="tag">book</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dns/"><span class="tag">dns</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/http/"><span class="tag">http</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/js/"><span class="tag">js</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/logparser/"><span class="tag">logparser</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/programming/"><span class="tag">programming</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/project/"><span class="tag">project</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pytest/"><span class="tag">pytest</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/roadmap/"><span class="tag">roadmap</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/study/"><span class="tag">study</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%94%A5%EB%9F%AC%EB%8B%9D/"><span class="tag">딥러닝</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%AA%A8%EB%8D%B8%EB%A7%81/"><span class="tag">모델링</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%AA%A8%EB%8D%B8%ED%95%99%EC%8A%B5/"><span class="tag">모델학습</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%B1%EC%97%94%EB%93%9C/"><span class="tag">백엔드</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%88%9C%EC%A0%84%ED%8C%8C/"><span class="tag">순전파</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%97%AD%EC%A0%84%ED%8C%8C/"><span class="tag">역전파</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C/"><span class="tag">프론트엔드</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">개발계발</a><p class="size-small"><span>&copy; 2020 Yejin Jeong</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://jyejin.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>